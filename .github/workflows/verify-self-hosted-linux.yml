name: Verify Self-Hosted Linux Runner
on:
  workflow_dispatch:

jobs:
  verify-environment:
    runs-on: [self-hosted, linux]
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: System Information
        run: |
          echo "=== System Info ==="
          echo "Hostname: $(hostname)"
          echo "User: $(whoami)"
          echo "Kernel: $(uname -r)"
          echo "Working Directory: $(pwd)"

      - name: Check Environment Variables
        run: |
          echo "=== Environment Variables ==="
          env | grep -v "SECRET" | sort

      - name: Check Tools
        run: |
          echo "=== Tool Versions ==="
          echo "Python: $(python3 --version 2>&1 || echo 'Not found')"
          echo "FFmpeg: $(ffmpeg -version | head -n 1 2>&1 || echo 'Not found')"
          
          # Check for uv in common paths if not in PATH
          if ! command -v uv &> /dev/null; then
              echo "uv not found in PATH. Checking common locations..."
              if [ -f "$HOME/.cargo/bin/uv" ]; then
                  echo "uv found at $HOME/.cargo/bin/uv"
                  export PATH="$HOME/.cargo/bin:$PATH"
              elif [ -f "/root/.cargo/bin/uv" ]; then
                  echo "uv found at /root/.cargo/bin/uv"
                  export PATH="/root/.cargo/bin:$PATH"
              fi
          fi
          echo "uv: $(uv --version 2>&1 || echo 'Not found')"

      - name: Verify Codebase Access
        run: |
          ls -la
